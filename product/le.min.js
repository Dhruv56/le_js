/*
 Copyright 2013 Logentries.
 Please view license at https://raw.github.com/logentries/le_js/master/LICENSE
*/
'use strict';var LE=function(b){function k(a){var s=(Math.random()+Math.PI).toString(36).substring(2,10),e=a.trace,f=a.page_info,n=a.token,k=a.print,p;p="undefined"===typeof XDomainRequest?a.ssl:"https:"===b.location.protocol?!0:!1;var g=[],h=!1,q=!1;if(a.catchall){var r=b.onerror;b.onerror=function(d,a,c){l({error:d,line:c,location:a}).level("ERROR").send();return r?r(d,a,c):!1}}var t=function(){var d=b.navigator||{doNotTrack:void 0},a=b.screen||{};return{url:(b.location||{}).pathname,referrer:document.referrer,
screen:{width:a.width,height:a.height},window:{width:b.innerWidth,height:b.innerHeight},browser:{name:d.appName,version:d.appVersion,cookie_enabled:d.cookieEnabled,do_not_track:d.doNotTrack},platform:d.platform}},u=function(){var a=null,a=Array.prototype.slice.call(arguments);if(0===a.length)throw Error("No arguments!");return a=1===a.length?a[0]:a},l=function(a){var b=u.apply(this,arguments),c={event:b};"never"===f||q&&"per-entry"!==f||(q=!0,"undefined"===typeof b.screen&&"undefined"===typeof b.browser&&
l(t()).level("PAGE").send());e&&(c.trace=s);return{level:function(a){if(k&&"undefined"!==typeof console&&"PAGE"!==a)try{console[a.toLowerCase()].call(console,c)}catch(b){console.log(c)}c.level=a;return{send:function(){var a=[],b=JSON.stringify(c,function(c,b){if("undefined"===typeof b)return"undefined";if("object"===typeof b&&null!==b){var d;a:{for(d=0;d<a.length;d++)if(b===a[d])break a;d=-1}if(-1!==d)return"<?>";a.push(b)}return b});h?g.push(b):m(n,b)}}}}};this.log=l;var m=function(a,b){h=!0;var c;
c="undefined"!==typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest;c.constructor===XMLHttpRequest?c.onreadystatechange=function(){4===c.readyState&&(400<=c.status?(console.error("Couldn't submit events."),410===c.status&&console.warn("This version of le_js is no longer supported!")):(301===c.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<g.length?m(a,g.shift()):h=!1))}:c.onload=function(){0<g.length?m(a,g.shift()):h=!1};c.open("POST",(p?"https://":"http://")+
"js.logentries.com/v1/logs/"+n,!0);c.constructor===XMLHttpRequest&&(c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-type","text/json"));c.send(b)}}var f,e=function(a){if(f)return f.log.apply(this,arguments);throw Error("You must call LE.init(...) first.");};return{init:function(a){var b={ssl:!0,catchall:!1,trace:!0,page_info:"never",print:!1};if("object"===typeof a)for(var e in a)b[e]=a[e];else if("string"===typeof a)b.token=a;else throw Error("Invalid parameters for init()");
if(void 0===b.token)throw Error("Token not present.");f=new k(b);return!0},log:function(){e.apply(this,arguments).level("LOG").send()},warn:function(){e.apply(this,arguments).level("WARN").send()},error:function(){e.apply(this,arguments).level("ERROR").send()},info:function(){e.apply(this,arguments).level("INFO").send()}}}(this);
